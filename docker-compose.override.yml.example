# 更多信息请参阅文档：https://www.librechat.ai/docs/configuration/docker_override

# 要使用此文件，首先取消注释 'services:' 这一行

# 然后只取消注释包含您想要应用的更改的部分
# 将此文件另存为 'docker-compose.override.yaml'
# 然后像平常一样使用 'docker compose build' 和 'docker compose up -d' 命令

# 警告：每个服务名称只能指定一次（api、mongodb、meilisearch 等）
# 如果您想在一个服务中覆盖多个设置，您需要相应地编辑

# 示例：如果您想使用配置文件并使用最新编号版本的 Docker 镜像，结果将是：

# services:
#   api:
#     volumes:
#     - type: bind
#       source: ./librechat.yaml
#       target: /app/librechat.yaml
#     image: ghcr.io/danny-avila/librechat:latest

# ---------------------------------------------------

# services:

# # 使用 LibreChat 配置文件
#   api:
#     volumes:
#     - type: bind
#       source: ./librechat.yaml
#       target: /app/librechat.yaml

# # 本地构建
#   api:
#     image: librechat
#     build:
#       context: .
#       target: node

# # 从最新镜像构建
#   api:
#     image: ghcr.io/danny-avila/librechat-dev:latest

# # 从最新镜像构建（编号版本）
#   api:
#     image: ghcr.io/danny-avila/librechat:latest

# # 从最新 API 镜像构建
#   api:
#     image: ghcr.io/danny-avila/librechat-dev-api:latest

# # 从最新 API 镜像构建（编号版本）
#   api:
#     image: ghcr.io/danny-avila/librechat-api:latest

# # 添加 SAML 证书文件
#   api:
#     volumes:
#     - type: bind
#       source: ./your_cert.pem
#       target: /app/your_cert.pem

# # 添加 MONGO-EXPRESS
#   mongo-express:
#     image: mongo-express
#     container_name: mongo-express
#     environment:
#       ME_CONFIG_MONGODB_SERVER: mongodb
#       ME_CONFIG_BASICAUTH_USERNAME: admin
#       ME_CONFIG_BASICAUTH_PASSWORD: password
#     ports:
#       - '8081:8081'
#     depends_on:
#       - mongodb
#     restart: always

# # 使用 MONGODB V4.4.18 - 适用于不支持 AVX 的旧 CPU
#   mongodb:
#     image: mongo:4.4.18

# # 禁用 MONGODB 容器 - 您需要在 .ENV 文件中设置替代的 MONGODB URI
#   api:
#     environment:
#       - MONGO_URI=${MONGO_URI}
#   mongodb:
#     image: tianon/true
#     command: ""
#     entrypoint: ""

# # 暴露 MONGODB 端口 - 请谨慎使用，这会使您的数据库容易受到攻击
#   mongodb:
#     ports:
#       - 27018:27017

# # 禁用 MEILISEARCH
#   meilisearch:
#     profiles:
#       - donotstart

# # 暴露 MEILISEARCH 端口 - 如果这样做，请不要使用默认的 MASTER KEY 值
#   meilisearch:
#     ports:
#       - 7700:7700

# # 使用支持本地嵌入的 RAG API 镜像
#  rag_api:
#    image: ghcr.io/danny-avila/librechat-rag-api-dev:latest
# # 对于 Linux 用户：
#    extra_hosts:
#      - "host.docker.internal:host-gateway"

# # 添加 OLLAMA
#  ollama:
#    image: ollama/ollama:latest
#    deploy:
#      resources:
#        reservations:
#          devices:
#            - driver: nvidia
#              capabilities: [compute, utility]
#    ports:
#      - "11434:11434"
#    volumes:
#      - ./ollama:/root/.ollama

# # 添加 LITELLM 基础版 - 需要配置 litellm-config.yaml，只需环境变量即可启用 REDIS 缓存或 LANGFUSE 监控
#  litellm:
#    image: ghcr.io/berriai/litellm:main-latest
#    volumes:
#      - ./litellm/litellm-config.yaml:/app/config.yaml
#      - ./litellm/application_default_credentials.json:/app/application_default_credentials.json # 仅在使用 Google Vertex 时需要
#    ports:
#      - "4000:8000"
#    command: [ "--config", "/app/config.yaml", "--port", "8000", "--num_workers", "8" ]
#    environment:
#      OPENAI_API_KEY: none ## 如果使用 ollama 的 openai api 兼容性，需要设置
#      GOOGLE_APPLICATION_CREDENTIALS: /app/application_default_credentials.json ## 仅在使用 Google Vertex 时需要
#      REDIS_HOST: redis
#      REDIS_PORT: 6379
#      REDIS_PASSWORD: RedisChangeMe
#      LANGFUSE_PUBLIC_KEY: pk-lf-RandomStringFromLangfuseWebInterface
#      LANGFUSE_SECRET_KEY: sk-lf-RandomStringFromLangfuseWebInterface
#      LANGFUSE_HOST: http://langfuse-server:3000

# # 添加 LITELLM 缓存
#  redis:
#    image: redis:7-alpine
#    command:
#    - sh
#    - -c # 这是为了从环境变量中评估 $REDIS_PASSWORD
#    - redis-server --appendonly yes --requirepass $$REDIS_PASSWORD ## $$ 是因为 docker-compose
#    environment:
#      REDIS_PASSWORD: RedisChangeMe
#    volumes:
#    - ./redis:/data

# # 添加 LITELLM 监控
#  langfuse-server:
#    image: ghcr.io/langfuse/langfuse:latest
#    depends_on:
#      - db
#    ports:
#      - "3000:3000"
#    environment:
#      - NODE_ENV=production
#      - DATABASE_URL=postgresql://postgres:PostgresChangeMe@db:5432/postgres
#      - NEXTAUTH_SECRET=ChangeMe
#      - SALT=ChangeMe
#      - NEXTAUTH_URL=http://localhost:3000
#      - TELEMETRY_ENABLED=${TELEMETRY_ENABLED:-true}
#      - NEXT_PUBLIC_SIGN_UP_DISABLED=${NEXT_PUBLIC_SIGN_UP_DISABLED:-false}
#      - LANGFUSE_ENABLE_EXPERIMENTAL_FEATURES=${LANGFUSE_ENABLE_EXPERIMENTAL_FEATURES:-false}
#  db:
#    image: postgres
#    restart: always
#    environment:
#      - POSTGRES_USER=postgres
#      - POSTGRES_PASSWORD=PostgresChangeMe
#      - POSTGRES_DB=postgres
#    volumes:
#      - ./postgres:/var/lib/postgresql/data
